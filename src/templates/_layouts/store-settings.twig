{% extends "commerce/_layouts/cp" %}
{% set selectedSubnavItem = 'store-settings' %}
{% set bodyClass = (bodyClass is defined ? bodyClass~' ' : '') ~ "commercesettings" %}

{% if selectedItem is not defined %}
    {% set selectedItem = craft.app.request.getSegment((craft.app.config.general.cpTrigger ? 4 : 3)) ?? 'general' %}
{% endif %}
{% if storeHandle is not defined %}
    {% set storeHandle = craft.app.request.getSegment((craft.app.config.general.cpTrigger ? 3 : 2)) ?? craft.commerce.stores.getPrimaryStore().handle %}
{% endif %}

{% set store = craft.commerce.stores.getStoreByHandle(storeHandle) %}

{% set title = 'Store Management'|t('commerce') %}

{% block toolbar %}
    {# store selector dropdown input #}
    {% if craft.commerce.stores.getAllStores().count() > 1 %}
        <div class="select">
            <select id="store-selector" class="text">
                {% for storeOption in craft.commerce.stores.getAllStores() %}
                    {# Include `store-settings` in the replace to avoid accidentally overrding another part of the URL #}
                    <option value="{{ craft.app.request.url|replace('store-settings/' ~ storeHandle, 'store-settings/' ~ storeOption.handle) }}" {% if store.id == storeOption.id %}selected{% endif %}>{{ storeOption.name }}</option>
                {% endfor %}
            </select>
        </div>
    {% endif %}
{% endblock %}
{% block sidebar %}
    <nav>
        <ul>
            {% for handle, item in storeSettingsNav %}
                {% if item.heading is defined %}
                    <li class="heading"><span>{{ item.heading }}</span></li>
                {% else %}
                    <li>
                        <a href="{{ store.getStoreSettingsUrl(item.path) }}"{% if handle == selectedItem %} class="sel"{% endif %}>{{ item.label }}</a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </nav>
{% endblock %}

{% js %}
    $('#store-selector').on('change', function() {
        var storeUrl = $(this).val();
        window.location.href = storeUrl;
    });
{% endjs %}
