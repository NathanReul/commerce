{"version":3,"file":"CatalogPricing.js","mappings":"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","sources":["webpack:///./js/CatalogPricing.js"],"sourcesContent":["/* jshint esversion: 6 */\n/* globals Craft, Garnish, $ */\nif (typeof Craft.Commerce === typeof undefined) {\n  Craft.Commerce = {};\n}\n\nCraft.Commerce.CatalogPricing = Garnish.Base.extend({\n  $catalogPricingRules: null,\n  $clearSearchBtn: null,\n  $filterBtn: null,\n  $search: null,\n  $searchContainer: null,\n  $tableContainer: null,\n  filterHuds: {},\n  searchTimeout: null,\n  searching: false,\n  view: null,\n  defaults: {},\n\n  init: function (view, tableContainer, settings) {\n    this.view = view;\n    this.$tableContainer = tableContainer;\n    this.$searchContainer = this.view.find('.search-container:first');\n    this.$search = this.$searchContainer.find('input:first');\n    this.$clearSearchBtn = this.$searchContainer.children('.clear-btn:first');\n    this.$filterBtn = this.$searchContainer.children('.filter-btn:first');\n    this.setSettings(settings, this.defaults);\n\n    if (this.settings.filterBtnActive) {\n      this.$filterBtn.addClass('active');\n    }\n\n    this.addListener(this.$filterBtn, 'click', 'showFilterHud');\n\n    this.addListener(this.$search, 'input', () => {\n      if (!this.searching && this.$search.val()) {\n        this.startSearching();\n      } else if (this.searching && !this.$search.val()) {\n        this.stopSearching();\n      }\n\n      if (this.searchTimeout) {\n        clearTimeout(this.searchTimeout);\n      }\n\n      this.searchTimeout = setTimeout(\n        this.updateTableIfSearchTextChanged.bind(this),\n        500\n      );\n    });\n\n    // Clear the search when the X button is clicked\n    this.addListener(this.$clearSearchBtn, 'click', () => {\n      this.clearSearch(true);\n\n      if (!Garnish.isMobileBrowser(true)) {\n        this.$search.trigger('focus');\n      }\n    });\n\n    this.iniCatalogPriceRules();\n  },\n\n  startSearching: function () {\n    // Show the clear button\n    this.$clearSearchBtn.removeClass('hidden');\n    this.searching = true;\n  },\n\n  clearSearch: function (updateTable) {\n    if (!this.searching) {\n      return;\n    }\n\n    this.$search.val('');\n\n    if (this.searchTimeout) {\n      clearTimeout(this.searchTimeout);\n    }\n\n    this.stopSearching();\n\n    if (updateTable) {\n      this.updateTableIfSearchTextChanged();\n    } else {\n      this.searchText = null;\n    }\n  },\n\n  stopSearching: function () {\n    // Hide the clear button\n    this.$clearSearchBtn.addClass('hidden');\n    this.searching = false;\n  },\n\n  showFilterHud: function () {\n    if (!this.getFilterHud()) {\n      this.createFilterHud();\n      this.updateFilterBtn();\n    } else {\n      this.getFilterHud().show();\n    }\n  },\n\n  updateFilterBtn: function () {\n    this.$filterBtn.removeClass('active');\n\n    if (this.getFilterHud()) {\n      this.$filterBtn\n        .attr('aria-controls', this.getFilterHud().id)\n        .attr('aria-expanded', this.getFilterHud().showing ? 'true' : 'false');\n\n      if (this.getFilterHud().showing || this.getFilterHud().hasRules()) {\n        this.$filterBtn.addClass('active');\n      }\n    } else {\n      this.$filterBtn.attr('aria-controls', null);\n    }\n  },\n\n  serializeConditionForm: function () {\n    if (!this.getFilterHud()) {\n      return null;\n    }\n\n    const el = this.getFilterHud().$body.find('.condition-container:first');\n    let _ = {};\n\n    $.map(el.serializeArray(), function (n) {\n      const keys = n.name.match(/[a-zA-Z0-9_\\\\]+|(?=\\[\\])/g);\n\n      if (keys.length > 1) {\n        let tmp = _;\n        let pop = keys.pop();\n        for (let i = 0; i < keys.length; i++) {\n          let j = keys[i];\n          (tmp[j] = !tmp[j] ? (pop == '' ? [] : {}) : tmp[j]), (tmp = tmp[j]);\n        }\n        if (pop == '') {\n          tmp = !Array.isArray(tmp) ? [] : tmp;\n          tmp.push(n.value);\n        } else {\n          tmp[pop] = n.value;\n        }\n      } else {\n        _[keys.pop()] = n.value;\n      }\n    });\n\n    return _;\n  },\n\n  getFilterHudKey: function () {\n    return `site-${this.settings.siteId}`;\n  },\n\n  createFilterHud: function () {\n    this.filterHuds[this.getFilterHudKey()] =\n      new Craft.Commerce.CatalogPricingHud(this, this.settings.siteId);\n  },\n\n  getFilterHud: function () {\n    if (Object.keys(this.filterHuds).indexOf(this.getFilterHudKey()) === -1) {\n      return null;\n    }\n\n    return this.filterHuds[this.getFilterHudKey()];\n  },\n\n  destroyFilterHud: function () {\n    if (this.getFilterHud()) {\n      delete this.filterHuds[this.getFilterHudKey()];\n    }\n  },\n\n  updateTableIfSearchTextChanged: function () {\n    if (\n      this.searchText !==\n      (this.searchText = this.searching ? this.$search.val() : null)\n    ) {\n      this.updateTable();\n    }\n  },\n\n  updateTable: function () {\n    let params = {\n      searchText: this.$search.val(),\n      siteId: this.settings.siteId,\n      condition: this.serializeConditionForm(),\n    };\n\n    Craft.sendActionRequest('POST', 'commerce/catalog-pricing/prices', {\n      data: params,\n    }).then((response) => {\n      this.removeCatalogPricingRuleListeners();\n\n      if (response.data && response.data.tableHtml) {\n        Craft.appendHeadHtml(response.data.headHtml);\n        Craft.appendBodyHtml(response.data.bodyHtml);\n\n        this.$tableContainer.html(response.data.tableHtml);\n        this.iniCatalogPriceRules();\n      }\n    });\n  },\n\n  removeCatalogPricingRuleListeners() {\n    this.$catalogPricingRules.off('click');\n  },\n\n  iniCatalogPriceRules() {\n    this.$catalogPricingRules = this.view.find('.js-cpr-slideout');\n\n    this.$catalogPricingRules.on('click', function (e) {\n      e.preventDefault();\n      const slideout = new Craft.CpScreenSlideout(\n        'commerce/catalog-pricing-rules/slideout',\n        {\n          params: {\n            storeId: $(this).data('store-id'),\n            purchasableId: $(this).data('purchasable-id'),\n            id: $(this).data('catalog-pricing-rule-id'),\n          },\n        }\n      );\n      slideout.on('submit', function ({response, data}) {\n        console.log(response, data);\n      });\n    });\n  },\n});\n\nCraft.Commerce.CatalogPricingHud = Garnish.HUD.extend({\n  view: null,\n  siteId: null,\n  id: null,\n  loading: true,\n  serialized: null,\n  $clearBtn: null,\n  cleared: false,\n\n  init: function (view, siteId) {\n    this.view = view;\n\n    this.siteId = siteId;\n    this.id = `filter-${Math.floor(Math.random() * 1000000000)}`;\n\n    const $loadingContent = $('<div/>')\n      .append(\n        $('<div/>', {\n          class: 'spinner',\n        })\n      )\n      .append(\n        $('<div/>', {\n          text: Craft.t('app', 'Loading'),\n          class: 'visually-hidden',\n          'aria-role': 'alert',\n        })\n      );\n\n    this.base(this.view.$filterBtn, $loadingContent, {\n      hudClass: 'hud element-filter-hud loading',\n    });\n\n    this.$hud.attr({\n      id: this.id,\n      'aria-live': 'polite',\n      'aria-busy': 'false',\n    });\n    this.$tip.remove();\n    this.$tip = null;\n\n    this.$body.on('submit', (ev) => {\n      ev.preventDefault();\n      this.hide();\n    });\n\n    Craft.sendActionRequest('POST', 'commerce/catalog-pricing/filter', {\n      data: {\n        condition: this.view.settings.condition,\n        id: `${this.id}-filters`,\n      },\n    })\n      .then((response) => {\n        this.loading = false;\n        this.$hud.removeClass('loading');\n        $loadingContent.remove();\n\n        this.$main.append(response.data.hudHtml);\n        Craft.appendHeadHtml(response.data.headHtml);\n        Craft.appendBodyHtml(response.data.bodyHtml);\n        this.view.settings.condition = response.data.condition;\n        this.serialized = this.view.serializeConditionForm();\n\n        const $btnContainer = $('<div/>', {\n          class: 'flex flex-nowrap',\n        }).appendTo(this.$main);\n        $('<div/>', {\n          class: 'flex-grow',\n        }).appendTo($btnContainer);\n        this.$clearBtn = $('<button/>', {\n          type: 'button',\n          class: 'btn',\n          text: Craft.t('app', 'Cancel'),\n        }).appendTo($btnContainer);\n        $('<button/>', {\n          type: 'submit',\n          class: 'btn secondary',\n          text: Craft.t('app', 'Apply'),\n        }).appendTo($btnContainer);\n        this.$clearBtn.on('click', () => {\n          this.clear();\n        });\n\n        this.$hud.find('.condition-container').on('htmx:beforeRequest', () => {\n          this.setBusy();\n        });\n\n        this.$hud.find('.condition-container').on('htmx:load', () => {\n          this.setReady();\n          this.updateSizeAndPosition(true);\n        });\n        this.setFocus();\n      })\n      .catch(() => {\n        Craft.cp.displayError(Craft.t('app', 'A server error occurred.'));\n      });\n\n    this.$hud.css('position', 'fixed');\n\n    this.addListener(Garnish.$win, 'scroll,resize', () => {\n      this.updateSizeAndPosition(true);\n    });\n  },\n\n  addListener: function (elem, events, data, func) {\n    if (elem === this.$main && events === 'resize') {\n      return;\n    }\n    this.base(elem, events, data, func);\n  },\n\n  setBusy: function () {\n    this.$hud.attr('aria-busy', 'true');\n\n    $('<div/>', {\n      class: 'visually-hidden',\n      text: Craft.t('app', 'Loading'),\n    }).insertAfter(this.$main.find('.htmx-indicator'));\n  },\n\n  setReady: function () {\n    this.$hud.attr('aria-busy', 'false');\n  },\n\n  setFocus: function () {\n    Garnish.setFocusWithin(this.$main);\n  },\n\n  clear: function () {\n    this.cleared = true;\n    this.destroy();\n    this.hide();\n  },\n\n  updateSizeAndPositionInternal: function () {\n    const searchOffset = this.view.$searchContainer[0].getBoundingClientRect();\n\n    // Ensure HUD is scrollable if content falls off-screen\n    const windowHeight = Garnish.$win.height();\n    let hudHeight;\n    const availableSpace = windowHeight - searchOffset.bottom;\n\n    if (this.$body.height() > availableSpace) {\n      hudHeight = windowHeight - searchOffset.bottom - 10;\n    }\n\n    this.$hud.css({\n      width: this.view.$searchContainer.outerWidth() - 2,\n      top: searchOffset.top + this.view.$searchContainer.outerHeight(),\n      left: searchOffset.left + 1,\n      height: hudHeight ? `${hudHeight}px` : 'unset',\n      overflowY: hudHeight ? 'scroll' : 'unset',\n    });\n  },\n\n  onShow: function () {\n    this.base();\n\n    // Cancel => Clear\n    if (this.$clearBtn && this.hasRules()) {\n      this.$clearBtn.text(Craft.t('app', 'Clear'));\n    } else if (this.$clearBtn && !this.hasRules()) {\n      this.$clearBtn.text(Craft.t('app', 'Cancel'));\n    }\n\n    this.view.updateFilterBtn();\n    this.setFocus();\n  },\n\n  onHide: function () {\n    this.base();\n\n    // If something changed, update the elements\n    if (\n      this.serialized !== (this.serialized = this.view.serializeConditionForm())\n    ) {\n      this.view.updateTable();\n    }\n\n    if (!this.cleared) {\n      this.$hud.detach();\n      this.$shade.detach();\n    }\n\n    this.view.updateFilterBtn();\n    this.view.$filterBtn.focus();\n  },\n\n  hasRules: function () {\n    return this.$main.has('.condition-rule').length !== 0;\n  },\n\n  destroy: function () {\n    this.base();\n\n    if (this.view.getFilterHud()) {\n      this.view.destroyFilterHud();\n    }\n  },\n});\n"],"names":["Craft","Commerce","CatalogPricing","Garnish","Base","extend","$catalogPricingRules","$clearSearchBtn","$filterBtn","$search","$searchContainer","$tableContainer","filterHuds","searchTimeout","searching","view","defaults","init","tableContainer","settings","this","find","children","setSettings","filterBtnActive","addClass","addListener","val","startSearching","stopSearching","clearTimeout","setTimeout","updateTableIfSearchTextChanged","bind","clearSearch","isMobileBrowser","trigger","iniCatalogPriceRules","removeClass","updateTable","searchText","showFilterHud","getFilterHud","show","createFilterHud","updateFilterBtn","attr","id","showing","hasRules","serializeConditionForm","el","$body","_","$","map","serializeArray","n","keys","name","match","length","tmp","pop","i","j","Array","isArray","push","value","getFilterHudKey","siteId","CatalogPricingHud","Object","indexOf","destroyFilterHud","params","condition","sendActionRequest","data","then","response","removeCatalogPricingRuleListeners","tableHtml","appendHeadHtml","headHtml","appendBodyHtml","bodyHtml","html","off","on","e","preventDefault","CpScreenSlideout","storeId","purchasableId","console","log","HUD","loading","serialized","$clearBtn","cleared","Math","floor","random","$loadingContent","append","class","text","t","base","hudClass","$hud","$tip","remove","ev","hide","$main","hudHtml","$btnContainer","appendTo","type","clear","setBusy","setReady","updateSizeAndPosition","setFocus","cp","displayError","css","$win","elem","events","func","insertAfter","setFocusWithin","destroy","updateSizeAndPositionInternal","hudHeight","searchOffset","getBoundingClientRect","windowHeight","height","availableSpace","bottom","width","outerWidth","top","outerHeight","left","overflowY","onShow","onHide","detach","$shade","focus","has"],"sourceRoot":""}