!function(){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},i(e)}"undefined"===i(Craft.Commerce)&&(Craft.Commerce={}),Craft.Commerce.PurchasablePriceField=Garnish.Base.extend({$container:null,$loadingElements:null,$refreshBtn:null,$tableContainer:null,$priceFields:null,$cprSlideouts:null,id:null,defaults:{catalogPricingRuleTempName:null,siteId:null,conditionBuilderConfig:null,fieldNames:{price:null,promotionalPrice:null}},init:function(i,e){this.setSettings(e,this.defaults),this.id=i,this.$container=$("#"+this.id),this.$tableContainer=this.$container.find(".js-price-list-container"),this.$loadingElements=this.$tableContainer.find(".js-prices-table-loading"),this.$refreshBtn=this.$container.find(".commerce-refresh-prices"),this.$priceFields=this.$container.find('input[name="'+this.settings.fieldNames.price+'"], input[name="'+this.settings.fieldNames.promotionalPrice+'"]'),this.$cprSlideouts=this.$container.find(".js-cpr-slideout"),this.initPurchasablePriceList(),this.$refreshBtn.on("click",(function(i){i.preventDefault()}))},updatePriceList:function(){var i=this;this.$loadingElements.removeClass("hidden"),Craft.sendActionRequest("POST","commerce/catalog-pricing/prices",{data:{siteId:this.settings.siteId,condition:{condition:this.settings.conditionBuilderConfig},basePrice:$('input[name="'+this.settings.fieldNames.price+'"]').val(),basePromotionalPrice:$('input[name="'+this.settings.fieldNames.promotionalPrice+'"]').val(),forPurchasable:!0,includeBasePrices:!1}}).then((function(e){i.$loadingElements.addClass("hidden"),e.data&&i.$tableContainer.find(".tableview").replaceWith(e.data.tableHtml),i.$priceFields.off("change"),i.$cprSlideouts.off("click"),i.initPurchasablePriceList()})).catch((function(e){var t=e.response;t&&(i.$loadingElements.addClass("hidden"),t.data&&t.data.message&&Craft.cp.displayError(t.data.message),i.$priceFields.off("change"),i.$cprSlideouts.off("click"),i.initPurchasablePriceList())}))},initPurchasablePriceList:function(){var i=this;this.$priceFields.on("change",(function(e){i.updatePriceList()})),this.$cprSlideouts.on("click",(function(e){e.preventDefault();var t=$(this),n={storeId:t.data("store-id")};t.data("catalog-pricing-rule-id")?n.id=t.data("catalog-pricing-rule-id"):(n.purchasableId=t.data("purchasable-id"),n.name=i.settings.catalogPricingRuleTempName),new Craft.CpScreenSlideout("commerce/catalog-pricing-rules/edit",{params:n}).on("submit",(function(e){e.response,e.data,i.updatePriceList()}))}))}})}();
//# sourceMappingURL=purchasablepricefield.js.map